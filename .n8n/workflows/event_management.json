{
  "name": "Event Management - Website Monitor & Packing List",
  "nodes": [
    {
      "parameters": {
        "cronExpression": "0 */6 * * *",
        "cronTimeZone": "Asia/Tokyo"
      },
      "name": "Every 6 Hours",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [240, 200]
    },
    {
      "parameters": {
        "url": "https://www.fujisan-marathon.jp/news",
        "options": {}
      },
      "name": "Fetch Official Website",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [460, 200]
    },
    {
      "parameters": {
        "functionCode": "// è§£æ HTML å–å¾—æœ€æ–°æ¶ˆæ¯æ¨™é¡Œèˆ‡é€£çµ\nconst html = items[0].json.body || items[0].binary?.data?.toString() || '';\n\n// ç°¡æ˜“ regex å–å¾—æ¨™é¡Œï¼ˆå¯¦éš›æ‡‰ç”¨å»ºè­°ç”¨ HTML parserï¼‰\nconst titleRegex = /<h3[^>]*>([^<]+)<\\/h3>/g;\nconst linkRegex = /<a[^>]*href=\"([^\"]+)\"[^>]*>/g;\n\nconst titles = [];\nlet match;\nwhile ((match = titleRegex.exec(html)) !== null) {\n  titles.push(match[1].trim());\n}\n\nconst links = [];\nwhile ((match = linkRegex.exec(html)) !== null) {\n  links.push(match[1]);\n}\n\n// å–å‰ 5 å‰‡\nconst news = titles.slice(0, 5).map((title, i) => ({\n  title,\n  url: links[i] || '#',\n  publishedDate: new Date().toISOString().split('T')[0]\n}));\n\nreturn news.map(item => ({ json: item }));"
      },
      "name": "Parse News",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [680, 200]
    },
    {
      "parameters": {
        "functionCode": "// å¾ Static Data æˆ– Google Sheets è®€å–ä¸Šæ¬¡å·²çŸ¥çš„æ¨™é¡Œ\nconst lastKnownTitles = $executionData?.lastNews || [];\nconst currentTitle = items[0].json.title;\n\n// åˆ¤æ–·æ˜¯å¦ç‚ºæ–°æ¨™é¡Œ\nconst isNew = !lastKnownTitles.includes(currentTitle);\n\nreturn [{\n  json: {\n    ...items[0].json,\n    isNew\n  }\n}];"
      },
      "name": "Check if New",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 200]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.isNew}}",
              "value2": true
            }
          ]
        }
      },
      "name": "Is New?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1120, 200]
    },
    {
      "parameters": {
        "chatId": "@your_telegram_chat_id",
        "text": "=ğŸ”” å¯Œå£«è·¯è·‘è³½äº‹æœ‰æ–°å…¬å‘Šï¼š\n\n{{$json.title}}\n\né€£çµï¼š{{$json.url}}"
      },
      "name": "Send Telegram Notification",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1340, 200]
    },
    {
      "parameters": {
        "cronExpression": "0 9 * * *",
        "cronTimeZone": "Asia/Tokyo"
      },
      "name": "Daily Check Calendar",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [240, 500]
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendarId": {
          "__rl": true,
          "mode": "list",
          "value": "primary"
        },
        "options": {
          "timeMin": "={{$now.plus({days: 3}).toISO()}}",
          "timeMax": "={{$now.plus({days: 4}).toISO()}}",
          "query": "å¯Œå£«è·¯è·‘"
        }
      },
      "name": "Get Calendar Events",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1,
      "position": [460, 500]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.length}}",
              "operation": "larger",
              "value2": 0
            }
          ]
        }
      },
      "name": "Has Event in 3 Days?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [680, 500]
    },
    {
      "parameters": {
        "functionCode": "// æ‰“åŒ…æ¸…å–®é …ç›®\nconst packingList = [\n  'è­·ç…§',\n  'è™Ÿç¢¼å¸ƒ',\n  'æ™¶ç‰‡ï¼ˆè¨ˆæ™‚ç”¨ï¼‰',\n  'èƒ½é‡è†  x 3-5 åŒ…',\n  'è·‘é‹ï¼ˆå·²ç£¨åˆï¼‰',\n  'é‹å‹•æœè£',\n  'é˜²æ›¬ä¹³',\n  'å¤ªé™½çœ¼é¡',\n  'å……é›»å™¨èˆ‡è¡Œå‹•é›»æº',\n  'æ—…è¡Œè—¥åŒ…ï¼ˆæ­¢ç—›è—¥ã€è‚Œè‚‰è²¼å¸ƒï¼‰',\n  'è¼•ä¾¿å¤–å¥—',\n  'æ›æ´—è¡£ç‰©'\n];\n\nreturn packingList.map(item => ({\n  json: { task: item }\n}));"
      },
      "name": "Generate Packing List",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 500]
    },
    {
      "parameters": {
        "resource": "task",
        "operation": "create",
        "project": {
          "__rl": true,
          "mode": "list",
          "value": "YOUR_TODOIST_PROJECT_ID"
        },
        "content": "={{$json.task}}",
        "options": {
          "dueDate": "={{$now.plus({days: 3}).toISODate()}}"
        }
      },
      "name": "Add to Todoist",
      "type": "n8n-nodes-base.todoist",
      "typeVersion": 1,
      "position": [1120, 500]
    },
    {
      "parameters": {
        "chatId": "@your_telegram_chat_id",
        "text": "æé†’ï¼šè·é›¢å¯Œå£«è·¯è·‘é–‹å§‹é‚„æœ‰ 3 å¤©ï¼Œå·²å°‡æ‰“åŒ…æ¸…å–®åŠ å…¥ä½ çš„ Todoistã€‚è¨˜å¾—æª¢æŸ¥è­·ç…§ã€è™Ÿç¢¼å¸ƒã€æ™¶ç‰‡ç­‰é‡è¦ç‰©å“ï¼ğŸ’"
      },
      "name": "Send Packing Reminder",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1340, 500]
    }
  ],
  "connections": {
    "Every 6 Hours": {
      "main": [[{ "node": "Fetch Official Website", "type": "main", "index": 0 }]]
    },
    "Fetch Official Website": {
      "main": [[{ "node": "Parse News", "type": "main", "index": 0 }]]
    },
    "Parse News": {
      "main": [[{ "node": "Check if New", "type": "main", "index": 0 }]]
    },
    "Check if New": {
      "main": [[{ "node": "Is New?", "type": "main", "index": 0 }]]
    },
    "Is New?": {
      "main": [[{ "node": "Send Telegram Notification", "type": "main", "index": 0 }], []]
    },
    "Daily Check Calendar": {
      "main": [[{ "node": "Get Calendar Events", "type": "main", "index": 0 }]]
    },
    "Get Calendar Events": {
      "main": [[{ "node": "Has Event in 3 Days?", "type": "main", "index": 0 }]]
    },
    "Has Event in 3 Days?": {
      "main": [
        [{ "node": "Generate Packing List", "type": "main", "index": 0 }],
        []
      ]
    },
    "Generate Packing List": {
      "main": [[{ "node": "Add to Todoist", "type": "main", "index": 0 }]]
    },
    "Add to Todoist": {
      "main": [[{ "node": "Send Packing Reminder", "type": "main", "index": 0 }]]
    }
  },
  "active": false,
  "settings": {}
}